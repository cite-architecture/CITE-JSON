package edu.holycross.shot.citejson

import edu.holycross.shot.cite._
import edu.holycross.shot.citeobj._
import edu.holycross.shot.scm._
import cats.syntax.either._
import io.circe._, io.circe.generic.auto._, io.circe.parser._, io.circe.syntax._
import org.scalatest.FlatSpec

class CiteLibraryJsonSpec extends FlatSpec {

  val citeLibraryMetadataJson:String = """{"name":"scs-akka test library","urn":"urn:cite2:cex:demo.2017_1:servicetest","license":"CC Share Alike.  For details, see more info."}"""

  val labelMapJson:String = """
{"labelMap":{"urn:cite2:hmt:e4img.2017a:e4_243":"Escrorial Ω 1.12 (Allen E4) image 243","urn:cite2:hmt:textblock.2017a:5":"Text-block 5","urn:cite2:hmt:textblock.testB:12":"Text-block 12","urn:cite2:hmt:e4img.2017a:e4_548":"Escrorial Ω 1.12 (Allen E4) image 548","urn:cite2:hmt:vaimg.2017a:VA085RN_0086":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 85, recto.","urn:cite2:hmt:e4.v1:7v":"Escorial Omega 1.12 folio 7v","urn:cite2:hmt:textblock.2017a:25":"Text-block 25","urn:cite2:hmt:textblock.testA:16":"Text-block 16","urn:cite2:hmt:e4img.2017a:e4_382":"Escrorial Ω 1.12 (Allen E4) image 382","urn:cite2:hmt:textblock.testA:22":"Text-block 22","urn:cite2:hmt:textblock.2017a:14":"Text-block 14","urn:cite2:hmt:textblock.testA:25":"Text-block 25","urn:cite2:hmt:textblock.testB:21":"Text-block 21","urn:cite2:hmt:e4img.2017a:e4_550":"Escrorial Ω 1.12 (Allen E4) image 550","urn:cite2:hmt:textblock.2017a:22":"Text-block 22","urn:cite2:hmt:textblock.testA:7":"Text-block 7","urn:cite2:hmt:textblock.2017a:11":"Text-block 11","urn:cite2:hmt:e4.v1:9r":"Escorial Omega 1.12 folio 9r","urn:cite2:hmt:textblock.2017a:2":"Text-block 2","urn:cite2:hmt:textblock.testB:25":"Text-block 25","urn:cite2:cite:datamodels.v1:binaryimg":"Binary image model","urn:cite2:hmt:textblock.testA:10":"Text-block 10","urn:cite2:hmt:msA.v1:3v":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 3v","urn:cite2:hmt:e4.v1:2r":"Escorial Omega 1.12 folio 2r","urn:cite2:hmt:textblock.2017a:8":"Text-block 8","urn:cite2:hmt:e4.v1:9v":"Escorial Omega 1.12 folio 9v","urn:cite2:hmt:textblock.testB:18":"Text-block 18","urn:cite2:hmt:vaimg.2017a:VA087RN_0088":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 87, recto.","urn:cite2:hmt:textblock.testB:16":"Text-block 16","urn:cite2:hmt:e4.v1:4v":"Escorial Omega 1.12 folio 4v","urn:cite2:hmt:msA.v1:3r":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 3r","urn:cite2:fufolio:msChad.2017a:7v":"msChad-7v","urn:cite2:hmt:textblock.testA:26":"Text-block 26","urn:cite2:fufolio:msChad.2017a:4v":"msChad-4v","urn:cite2:hmt:textblock.testB:5":"Text-block 5","urn:cite2:hmt:textblock.testA:2":"Text-block 2","urn:cite2:hmt:textblock.2017a:18":"Text-block 18","urn:cite2:hmt:msA.v1:2v":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 2v","urn:cite2:hmt:textblock.testB:11":"Text-block 11","urn:cite2:hmt:e4.v1:6r":"Escorial Omega 1.12 folio 6r","urn:cite2:hmt:vaimg.2017a:VA089RN_0090":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 89, recto.","urn:cite2:hmt:textblock.testB:24":"Text-block 24","urn:cite2:hmt:vaimg.2017a:VA082RN_0083":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 82, recto.","urn:cite2:hmt:textblock.testA:6":"Text-block 6","urn:cite2:hmt:textblock.2017a:23":"Text-block 23","urn:cite2:hmt:textblock.testB:2":"Text-block 2","urn:cite2:hmt:textblock.2017a:12":"Text-block 12","urn:cite2:hmt:textblock.2017a:1":"Text-block 1","urn:cite2:hmt:e4img.2017a:e4_549":"Escrorial Ω 1.12 (Allen E4) image 549","urn:cite2:hmt:textblock.2017a:28":"Text-block 28","urn:cite2:hmt:textblock.2017a:4":"Text-block 4","urn:cite2:hmt:e4.v1:6v":"Escorial Omega 1.12 folio 6v","urn:cite2:hmt:textblock.testA:19":"Text-block 19","urn:cite2:hmt:e4.v1:3r":"Escorial Omega 1.12 folio 3r","urn:cite2:hmt:textblock.2017a:17":"Text-block 17","urn:cite2:hmt:e4img.2017a:e4_242":"Escrorial Ω 1.12 (Allen E4) image 242","urn:cite2:hmt:textblock.testA:21":"Text-block 21","urn:cite2:hmt:textblock.testB:6":"Text-block 6","urn:cite2:hmt:e4img.2017a:e4_553":"Escrorial Ω 1.12 (Allen E4) image 553","urn:cite2:fufolio:msChad.2017a:4r":"msChad-4r","urn:cite2:hmt:textblock.testA:3":"Text-block 3","urn:cite2:hmt:vaimg.2017a:VA091RN_0092":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 91, recto.","urn:cite2:hmt:e4.v1:1v":"Escorial Omega 1.12 folio 1v","urn:cite2:hmt:binaryimg.v1:vaimg_amphoreusIIF":"Binary data for images of the Venetus A manuscript. IIIF Files at the University of Houson.","urn:cite2:hmt:textblock.testB:19":"Text-block 19","urn:cite2:hmt:textblock.testA:11":"Text-block 11","urn:cite2:hmt:textblock.testB:15":"Text-block 15","urn:cite2:hmt:textblock.2017a:9":"Text-block 9","urn:cite2:hmt:textblock.testA:14":"Text-block 14","urn:cite2:hmt:textblock.testA:27":"Text-block 27","urn:cite2:hmt:e4.v1:5r":"Escorial Omega 1.12 folio 5r","urn:cite2:hmt:vaimg.2017a:VA090RN_0091":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 90, recto.","urn:cite2:fufolio:msChad.2017a:3v":"msChad-3v","urn:cite2:hmt:textblock.testB:20":"Text-block 20","urn:cite2:hmt:textblock.testA:5":"Text-block 5","urn:cite2:hmt:textblock.testB:10":"Text-block 10","urn:cite2:hmt:textblock.testA:18":"Text-block 18","urn:cite2:hmt:textblock.2017a:24":"Text-block 24","urn:cite2:hmt:msA.v1:4r":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 4r","urn:cite2:fufolio:msChad.2017a:1v":"msChad-1v","urn:cite2:hmt:textblock.testB:23":"Text-block 23","urn:cite2:hmt:textblock.testB:1":"Text-block 1","urn:cite2:hmt:e4img.2017a:e4_552":"Escrorial Ω 1.12 (Allen E4) image 552","urn:cite2:hmt:e4.v1:5v":"Escorial Omega 1.12 folio 5v","urn:cite2:fufolio:msChad.2017a:5v":"msChad-5v","urn:cite2:hmt:msA.v1:1v":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 1v","urn:cite2:hmt:vaimg.2017a:VA086RN_0087":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 86, recto.","urn:cite2:hmt:msA.v1:2r":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 2r","urn:cite2:hmt:textblock.testA:20":"Text-block 20","urn:cite2:hmt:textblock.2017a:13":"Text-block 13","urn:cite2:hmt:textblock.2017a:16":"Text-block 16","urn:cite2:fufolio:msChad.2017a:8r":"msChad-8r","urn:cite2:hmt:textblock.testB:13":"Text-block 13","urn:cite2:hmt:textblock.2017a:3":"Text-block 3","urn:cite2:hmt:textblock.testA:12":"Text-block 12","urn:cite2:hmt:textblock.testB:28":"Text-block 28","urn:cite2:fufolio:msChad.2017a:FrontBoardv":"msChad-FrontBoardv","urn:cite2:hmt:msA.v1:1r":"Marcianus Graecus Z. 454 (= 822) (Venetus A) folio 1r","urn:cite2:hmt:textblock.2017a:27":"Text-block 27","urn:cite2:hmt:textblock.testA:24":"Text-block 24","urn:cite2:hmt:e4.v1:4r":"Escorial Omega 1.12 folio 4r","urn:cite2:hmt:textblock.testB:7":"Text-block 7","urn:cite2:hmt:textblock.testB:8":"Text-block 8","urn:cite2:hmt:textblock.testA:4":"Text-block 4","urn:cite2:hmt:e4img.2017a:e4_241":"Escrorial Ω 1.12 (Allen E4) image 241","urn:cite2:hmt:vaimg.2017a:VA012RN_0013":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 12, recto.","urn:cite2:hmt:textblock.testB:14":"Text-block 14","urn:cite2:fufolio:msChad.2017a:3r":"msChad-3r","urn:cite2:hmt:e4.v1:2v":"Escorial Omega 1.12 folio 2v","urn:cite2:hmt:textblock.2017a:20":"Text-block 20","urn:cite2:hmt:textblock.testA:28":"Text-block 28","urn:cite2:hmt:textblock.testA:1":"Text-block 1","urn:cite2:hmt:e4img.2017a:e4_245":"Escrorial Ω 1.12 (Allen E4) image 245","urn:cite2:hmt:textblock.testA:15":"Text-block 15","urn:cite2:hmt:binaryimg.v1:vaimg_iipDeepZoom":"Binary data for images of the Venetus A manuscript. IIIF Files at the University of Houson. (must add .tif.dzi)","urn:cite2:hmt:textblock.testB:27":"Text-block 27","urn:cite2:fufolio:msChad.2017a:5r":"msChad-5r","urn:cite2:fufolio:msChad.2017a:2r":"msChad-2r","urn:cite2:hmt:e4img.2017a:e4_551":"Escrorial Ω 1.12 (Allen E4) image 551","urn:cite2:hmt:e4.v1:8r":"Escorial Omega 1.12 folio 8r","urn:cite2:hmt:textblock.2017a:15":"Text-block 15","urn:cite2:hmt:e4img.2017a:e4_244":"Escrorial Ω 1.12 (Allen E4) image 244","urn:cite2:hmt:vaimg.2017a:VA092RN_0093":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 92, recto.","urn:cite2:hmt:textblock.testB:22":"Text-block 22","urn:cite2:hmt:textblock.2017a:10":"Text-block 10","urn:cite2:hmt:vaimg.2017a:VA084RN_0085":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 84, recto.","urn:cite2:fufolio:msChad.2017a:2v":"msChad-2v","urn:cite2:fufolio:msChad.2017a:6v":"msChad-6v","urn:cite2:hmt:vaimg.2017a:VA083RN_0084":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 83, recto.","urn:cite2:hmt:textblock.2017a:26":"Text-block 26","urn:cite2:hmt:textblock.testA:17":"Text-block 17","urn:cite2:hmt:textblock.2017a:6":"Text-block 6","urn:cite2:fufolio:msChad.2017a:7r":"msChad-7r","urn:cite2:hmt:textblock.testA:9":"Text-block 9","urn:cite2:cite:datamodels.v1:imagemodel":"Citable images","urn:cite2:hmt:e4.v1:8v":"Escorial Omega 1.12 folio 8v","urn:cite2:hmt:textblock.testB:3":"Text-block 3","urn:cite2:hmt:textblock.testA:8":"Text-block 8","urn:cite2:hmt:textblock.testA:13":"Text-block 13","urn:cite2:hmt:textblock.2017a:21":"Text-block 21","urn:cite2:hmt:e4.v1:1r":"Escorial Omega 1.12 folio 1r","urn:cite2:hmt:binaryimg.v1:e4img_iiif":"Binary data for images of the Escrorial Ω 1.12  manuscript served by the IIIF API","urn:cite2:hmt:textblock.testB:17":"Text-block 17","urn:cite2:hmt:textblock.testA:23":"Text-block 23","urn:cite2:hmt:vaimg.2017a:VA088RN_0089":"Venetus A: Marcianus Graecus Z. 454 (= 822).  Photograph in natural light, folio 88, recto.","urn:cite2:hmt:textblock.testB:4":"Text-block 4","urn:cite2:hmt:textblock.testB:9":"Text-block 9","urn:cite2:hmt:e4.v1:3v":"Escorial Omega 1.12 folio 3v","urn:cite2:hmt:textblock.2017a:7":"Text-block 7","urn:cite2:hmt:textblock.2017a:19":"Text-block 19","urn:cite2:hmt:textblock.testB:26":"Text-block 26","urn:cite2:fufolio:msChad.2017a:1r":"msChad-1r","urn:cite2:fufolio:msChad.2017a:6r":"msChad-6r","urn:cite2:hmt:e4.v1:7r":"Escorial Omega 1.12 folio 7r"}}

  """
  
  "The CiteLibraryJson Library" should "parse a Json expression of a CiteLibrary's metadata" in {
    val clj:CiteLibraryJson = CiteLibraryJson()
    assert(clj.exists)
    val libMD:Map[String,String] = clj.parseLibraryInfo(citeLibraryMetadataJson)
    assert(libMD("urn") == "urn:cite2:cex:demo.2017_1:servicetest")
    assert(libMD("name") == "scs-akka test library")
    assert(libMD("license") == "CC Share Alike.  For details, see more info.")
  }

  it should "parse a Json expression of a 'labelMap', Map[Cite2Urn,String]" in {
    val cjo:CiteLibraryJson = CiteLibraryJson()
    assert(cjo.exists)
    val labelMap:Map[Cite2Urn,String] = cjo.parseLabelMap(labelMapJson)
    assert(labelMap(Cite2Urn("urn:cite2:hmt:textblock.testA:22")) == "Text-block 22")
  }
}
